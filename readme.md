=====

2025.05.10  
とりま迷路 ってヤツ = Part 2 =

Python 3.13.0  
pygame 2.6.1  
IDE:VSCode Studio + Trae  
Google Coad Assist + GPT-4.1  

[ ゲームの概要 ]  
Type A: 迷路の中で制限時間内にゴールに到達するだけ  
        タイムボーナスあり  
Type B: 迷路の中で制限時間内にゴールに到達するのはType Aと同じ  
        タイムボーナスに加えワープあり  
Type C: 迷路の中で制限時間内にゴールに近づけるか
        ゴールするしない関係なくスコア付与
        ゴールした場合はその時点の残り時間と合わせてスコア付与

[ キーバインド ]  
[Enter]: ゲームスタート  
各種[矢印]: ゲームタイプの選択・プレイヤーの移動  
           (移動範囲はキー1回押しで視界内の1タイル、連続押し・長押しは不可)  
[H]: ヘルプ(迷路全体確認)  
[Esc]: ゲーム終了  

[ 迷路内タイルの説明 ]  
WHITE:壁  
GREEN:プレイヤー  
RED:ゴール  
DARK_GLAY:視界上通行できるタイル  
プレイヤー中心に隣接するタイル(全方向各1タイル)がヒントとなる  

1: 迷路全体に渡ってルートが見えない(ただし、ヒントは出る)  
    ゴールは必ず右下に表示される  

2: Type A･Bは共にタイムトライアル制で制限時間内にゴールに到達するとクリア  
    ※スコアの計算方法  
      スコア(残時間) = 制限時間 - 経過時間  
      時間切れの場合はスコアは0  

3: Type Cは制限時間内にどのくらいゴールに近づけるか  
    ・時間切れでゴールに到達できなくても  
      マンハッタン距離によって計算されたスコアを付与する
    ・制限時間内にゴールした場合はその時点で終了し  
      残り時間と合わせてスコアを付与する

4: ボーナスアイテムをゲットすると  
    TOMATO(3個ランダム配置):10秒加算  
    ORANGE(2個ランダム配置):30秒加算  
    PALE_GREEN(1個ランダム配置):60秒加算がそれぞれ加算されるが  
    ランダム間隔ごとに移動するので注意  
    ボーナスアイテムで加算された時間もスコアに反映される  

5:HELP(ヘルプ・[H])で迷路全体を確認することができるが  
    プレイ中はペナルティとして3秒制限時間から減らされる  
    ※デモ画面でも表示出来るがプレイ画面と同じ迷路とは限らない  

※ コードの一部について  
   参照されていない部分は削除すると動かなくなる可能性があるため  
   念のため残している  

※ プレイ中の移動はキー1回押しで視界内の1タイルなため  
   長時間プレイすることによって
   手腕の疲れや痛みを感じる可能性があるので注意

※ Type Bでワープ後  
   プレイヤーが点滅することによって  
   現在位置を確認出来る仕様  
   運が良ければ制限時間内にゴール可能  

--- マンハッタン距離 ---

都市の街区のように格子状に整備された経路を移動する際の距離の考え方  
ちょうど、アメリカのマンハッタンの道路が碁盤の目のようになっていることから名づけられた  

具体的には2つの地点があったとき  
それぞれのX座標の差の絶対値とY座標の差の絶対値を足し合わせたものになり  
<span style="color:yellow">斜めの移動は考慮せず</span>  
東西方向と南北方向にしか移動できない場合の最短距離と考えると分かりやすい    

数式で表すと、2点 (x₁, y₁) と (x₂, y₂) の間のマンハッタン距離の求め方  

  <span style="color:yellow">マンハッタン距離 = |x１ - x２| + |y１ - y２|</span>  


--- ボーナスアイテム ---

BONUS_MOVE_INTERVAL が5秒に設定されているにも関わらず、ボーナスアイテムが一斉に移動しないのは、  
各アイテムの最初の移動タイミングと、移動後の次の移動タイミングの基準がそれぞれ異なるため  

具体的には、以下の2つのポイントが影響している  

1: ボーナスアイテムの初期化時 (initialize_bonus_items 関数内):  
各ボーナスアイテムが最初に配置される際、それぞれの next_move_time（次に移動する時刻）は  
以下のように設定  

    "next_move_time": now + random.randint(1, BONUS_MOVE_INTERVAL) * 1000,  

ここで now は現在の時刻、random.randint(1, BONUS_MOVE_INTERVAL) は1から BONUS_MOVE_INTERVAL（現在は5）までのランダムな整数を返す  
つまり、各アイテムはゲーム開始から1～5秒後のランダムなタイミングで最初の移動を行うように設定されるため  
スタート時点から移動タイミングがずれる

2: ボーナスアイテムの移動後 (move_bonus_item 関数内):  
アイテムが移動に成功すると、そのアイテムの次の next_move_time は
以下のように設定  

    item_to_move["next_move_time"] = pygame.time.get_ticks() + BONUS_MOVE_INTERVAL * 1000

これは、そのアイテムが実際に移動した時刻を基準に    
BONUS_MOVE_INTERVAL（5秒）後に次の移動を行うように設定される      

これらの組み合わせにより  
各ボーナスアイテムは個別に約5秒間隔で移動するが   
それぞれの移動サイクルが同期していないため、全体として見るとバラバラのタイミングで移動しているように見える

=====